<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .code {
      height: 90vh;
      width: 45vw;
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      line-height: 1.5rem;
    }
    button{
      padding: 15px;
      font-size: 1.5em;
    }
  </style>
  <title>Meta Buffer Pack: example  </title>
</head>

<body>
  
  <div><button id="evalBtn">EVAL</button></div>
  <textarea class='code' id="code" cols="30" rows="10" spellcheck="false">
  // IIFE 
  // 1. include  meta-buffer-pack.min.js  
  // 2. Use global MBP 
  // 3. Use global MBP.Buffer for Node's Buffer.


  // pack()  multiple meta buffers => one buffer
    let pack = MBP.pack(
    MBP.MB('v1','8',123),  // uint8
    MBP.MB('v2','i16',-31234),  //int16
    MBP.MB('v3','16L', 0x1234),  //Uint16 LittleEndian
    MBP.MB('v4','32', 4200000000),   // uint32
    MBP.MB('pi','f', 3.141592),   // float as 4bytes buffer
    MBP.MB('v5','n', 123.456),   // float as number string
    MBP.MB('vStr','abcde'),  // buffer string
    MBP.MB('#omitInfo','bufferConatinsThisData')  // if name includes # then omit info data.
  )

  // hex view
    let hex = MBP.hex( pack )
    prn('mbpHex', hex)

  // base64 view
    let b64 = pack.toString('base64')
    prn('base64',b64)


  //unpack:  buffer -> object
    let obj = MBP.unpack( pack )
    prnObj('mbpObj', obj)

    prn( 'obj.v4', obj.v4 )

  function packFunctionParams( ...args){
    return MBP.pack(  MBP.MBA(...args) )
  }

  let mbaPack = packFunctionParams( 'hi', 2332, 22.2, [1, 2, 3], { 'hi': 'yeh' }, true )

  prn( mbaPack.byteLength )
  let mbaObj = MBP.unpack( mbaPack )

  prnObj('mbaObj', mbaObj.args )  // or mbaObj.$ 

  // Node Buffer in the browser. 
  const Buffer = MBP.Buffer;

  let buf = Buffer.from([1,2,3] )
  prn( 'hex', buf.toString('hex') )
  prn( 'base64', buf.toString('base64') )
  prn( 'hex', Buffer.from('abcdefg').toString('hex') )


  </textarea>
  <textarea class='code' id="result" cols="30" rows="10" spellcheck="false">
  result:</textarea>

</body>

<script src="../dist/meta-buffer-pack.min.js"></script>
<script >
  const Buffer = MBP.Buffer;

  const NB = MBP.NB;
  const MB = MBP.MB;
  const MBA = MBP.MBA;

  evalBtn.addEventListener('click', e => {
    console.log(code.value)
    result.innerHTML = ''
    eval(code.value)
  })

  function prn(tag, v) {
    result.innerHTML += "\n" + tag + ":\n" + v 
    console.log(v)
  }
  function prnObj(tag, v) {
    v = JSON.stringify(v , null, 2)
    result.innerHTML += "\n" +tag + ":\n" + v 
    console.log(v)
  }
</script>

</html>